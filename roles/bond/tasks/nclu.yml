- name: configure host bond
  nclu:
    template: |
      {% for item in bonding_ %}
      add bond {{ item.name }} bond slaves {{ item.slaves }}
      add bond {{ item.name }} clag id {{ item.clag_id }}
      {% if item.mode == 'access' %}
      add bond {{ item.name }} bridge access {{ item.vlans | join(',') }}
      {% else %}
      add bond {{ item.name }} bridge trunk vlans {{ item.vlans | join(',') }}
      {% endif %}
      {% endfor %}
    commit: true
  when: bonding_ is iterable
